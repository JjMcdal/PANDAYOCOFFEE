<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pandayo Coffee</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; }
    .container { max-width: 400px; margin: 50px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .tabs { display: flex; justify-content: space-between; margin-bottom: 20px; }
    .tabs button { flex: 1; padding: 10px; border: none; background: #eee; cursor: pointer; }
    .tabs button.active { background: #333; color: #fff; }
    form { display: none; }
    form.active { display: block; }
    label { display: block; margin: 10px 0 5px; }
    input { width: 100%; padding: 8px; margin-bottom: 15px; }
    .password-wrapper { position: relative; }
    .password-wrapper button { position: absolute; right: 10px; top: 8px; background: none; border: none; cursor: pointer; }
    .btn { width: 100%; padding: 10px; background: #333; color: #fff; border: none; cursor: pointer; }
    #message { margin-top: 20px; text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Pandayo Coffee</h1>

    <!-- Tabs -->
    <div class="tabs">
      <button id="tab-register" class="active">Register</button>
      <button id="tab-login">Login</button>
      <button id="tab-change">Change Password</button>
    </div>

    <!-- Register Form -->
    <form id="register-form" class="active">
      <label>Username</label>
      <input type="text" id="reg-username" required placeholder="Username" />

      <label>Email</label>
      <input type="email" id="reg-email" required placeholder="Email" />

      <label>Password</label>
      <div class="password-wrapper">
        <input type="password" id="reg-password" required placeholder="Password" />
        <button type="button" class="toggle-pass" data-target="reg-password">Show</button>
      </div>

      <button type="submit" class="btn">Register</button>
    </form>

    <!-- Login Form -->
    <form id="login-form">
      <label>Email</label>
      <input type="email" id="login-email" required placeholder="Email" />

      <label>Password</label>
      <div class="password-wrapper">
        <input type="password" id="login-password" required placeholder="Password" />
        <button type="button" class="toggle-pass" data-target="login-password">Show</button>
      </div>

      <button type="submit" class="btn">Login</button>
    </form>

    <!-- Change Password Form -->
    <form id="change-password-form">
      <label>Email</label>
      <input type="email" id="cp-email" required placeholder="Email" />

      <label>Old Password</label>
      <input type="password" id="cp-old-password" required placeholder="Old Password" />

      <label>New Password</label>
      <input type="password" id="cp-new-password" required placeholder="New Password" />

      <button type="submit" class="btn">Change Password</button>
    </form>

    <p id="message"></p>
  </div>

  <script>
    const tabs = {
      register: document.getElementById('tab-register'),
      login: document.getElementById('tab-login'),
      change: document.getElementById('tab-change'),
    };
    const forms = {
      register: document.getElementById('register-form'),
      login: document.getElementById('login-form'),
      change: document.getElementById('change-password-form'),
    };
    const message = document.getElementById('message');

    // Toggle Tabs
    Object.entries(tabs).forEach(([key, tab]) => {
      tab.addEventListener('click', () => {
        Object.values(tabs).forEach(btn => btn.classList.remove('active'));
        Object.values(forms).forEach(form => form.classList.remove('active'));
        tab.classList.add('active');
        forms[key].classList.add('active');
        message.textContent = '';
      });
    });

    // Toggle Show/Hide Password
    document.querySelectorAll('.toggle-pass').forEach(btn => {
      btn.addEventListener('click', () => {
        const target = document.getElementById(btn.dataset.target);
        const type = target.getAttribute('type') === 'password' ? 'text' : 'password';
        target.setAttribute('type', type);
        btn.textContent = type === 'password' ? 'Show' : 'Hide';
      });
    });

    // Register
    forms.register.addEventListener('submit', async (e) => {
      e.preventDefault();
      const username = document.getElementById('reg-username').value;
      const email = document.getElementById('reg-email').value;
      const password = document.getElementById('reg-password').value;

      const res = await fetch('/api/register', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ username, email, password })
      });
      const data = await res.json();
      message.textContent = res.ok ? '✅ Registered!' : `❌ ${data.error}`;
      message.style.color = res.ok ? 'green' : 'red';
    });

    // Login
    forms.login.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      const res = await fetch('/api/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      message.textContent = res.ok ? '✅ Login successful!' : `❌ ${data.error}`;
      message.style.color = res.ok ? 'green' : 'red';
    });

    // Change Password
    forms.change.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('cp-email').value;
      const oldPassword = document.getElementById('cp-old-password').value;
      const newPassword = document.getElementById('cp-new-password').value;

      const res = await fetch('/api/change-password', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ email, oldPassword, newPassword })
      });
      const data = await res.json();
      message.textContent = res.ok ? '✅ Password changed!' : `❌ ${data.error}`;
      message.style.color = res.ok ? 'green' : 'red';
    });
  </script>
</body>
</html>
